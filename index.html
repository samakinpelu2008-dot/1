<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>IEM Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui;}
body,html{height:100%;background:#0f1720;color:#e5e7eb;overflow:hidden;}

.app{
  height:100%;
  display:flex;
  flex-direction:column;
}

/* TOP BAR */
.topbar{
  height:60px;
  background:#075E54;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 15px;
  color:white;
}
.topbar h1{font-size:20px;}
.topbar button{
  background:none;
  border:none;
  color:white;
  font-size:18px;
  cursor:pointer;
}

/* SEARCH */
.search{
  padding:10px;
  background:#111b21;
}
.search input{
  width:100%;
  padding:10px 15px;
  border-radius:25px;
  border:none;
  outline:none;
  background:#2a3942;
  color:white;
}

/* CHAT LIST */
.chat-list{
  flex:1;
  overflow-y:auto;
}
.chat{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 15px;
  border-bottom:1px solid #1f2c33;
  cursor:pointer;
}
.chat:hover{background:#1c262b;}

.avatar{
  width:52px;
  height:52px;
  border-radius:50%;
  background:#25D366;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  font-weight:900;
  color:#111;
}
.name{
  font-size:16px;
  font-weight:600;
}
</style>
</head>

<body>
<div class="app">

  <div class="topbar">
    <h1>IEM Chat</h1>
    <button onclick="logout()">â†» Reset</button>
  </div>

  <div class="search">
    <input placeholder="Search" onkeyup="filter(this.value)">
  </div>

  <div class="chat-list" id="list"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDCBD2gVIg9v-KqYaMFZeu_grgs3yKYfPs",
  authDomain: "fir-chat-f8d55.firebaseapp.com",
  projectId: "fir-chat-f8d55",
  storageBucket: "fir-chat-f8d55.appspot.com",
  messagingSenderId: "792896094694",
  appId: "1:792896094694:web:dd373e5d7d2fc9ae1d5627"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let allContacts = [];

onAuthStateChanged(auth, user=>{
  if(!user) return;

  const ref = collection(db,"contacts",user.uid,"list");
  onSnapshot(ref,snap=>{
    allContacts = snap.docs.map(d=>d.data());
    render(allContacts);
  });
});

function render(list){
  const el = document.getElementById("list");
  el.innerHTML="";
  list.forEach(c=>{
    const div=document.createElement("div");
    div.className="chat";
    div.innerHTML=`
      <div class="avatar">${c.name[0].toUpperCase()}</div>
      <div class="name">${c.name || c.userId}</div>
    `;
    div.onclick=()=>alert("Next: open chat screen");
    el.appendChild(div);
  });
}

window.filter = txt=>{
  render(allContacts.filter(c=>
    c.name.toLowerCase().includes(txt.toLowerCase()) ||
    c.userId.toLowerCase().includes(txt.toLowerCase())
  ));
};

window.logout = async ()=>{
  await signOut(auth);
  location.reload();
};
</script>
</body>
</html>
