<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IEM Chat ‚Äì Debug + Contacts</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#0f1720;
  color:#e5e7eb;
  font-family: monospace;
  padding:20px;
}
h2,h3{ margin-top:20px; }
.status{
  margin:8px 0;
  padding:10px;
  border-radius:6px;
}
.ok{ background:#064e3b; }
.warn{ background:#78350f; }
.err{ background:#7f1d1d; }

input,button{
  padding:10px;
  margin-top:10px;
  width:100%;
  max-width:400px;
  border-radius:6px;
  border:none;
  outline:none;
}
button{
  background:#22c55e;
  color:black;
  font-weight:bold;
  cursor:pointer;
}
button:hover{ opacity:.9; }

.contact{
  background:#1f2933;
  padding:10px;
  margin:5px 0;
  border-radius:6px;
}
</style>
</head>

<body>

<h2>IEM CHAT ‚Äì DEBUG MODE</h2>

<div id="log"></div>

<hr>

<h3>Add Contact</h3>
<input id="cName" placeholder="Contact name (optional)">
<input id="cId" placeholder="User ID (required)">
<button onclick="addContact()">Save Contact</button>

<hr>

<h3>Contacts</h3>
<div id="contacts"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, onSnapshot, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const log = (msg, cls="ok")=>{
  const d = document.createElement("div");
  d.className = "status "+cls;
  d.innerText = msg;
  document.getElementById("log").appendChild(d);
};

log("JS running ‚úÖ");

// üîπ Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDCBD2gVIg9v-KqYaMFZeu_grgs3yKYfPs",
  authDomain: "fir-chat-f8d55.firebaseapp.com",
  projectId: "fir-chat-f8d55",
  storageBucket: "fir-chat-f8d55.appspot.com",
  messagingSenderId: "792896094694",
  appId: "1:792896094694:web:dd373e5d7d2fc9ae1d5627"
};

// üîπ Init Firebase
const app = initializeApp(firebaseConfig);
log("Firebase initialized ‚úÖ");

const auth = getAuth(app);
const db = getFirestore(app);

// üîπ Auth state
onAuthStateChanged(auth, user=>{
  if(!user){
    log("No authenticated user ‚ùå", "err");
    return;
  }

  log("User authenticated ‚úÖ UID: "+user.uid);

  const contactsRef = collection(db,"contacts",user.uid,"list");

  onSnapshot(contactsRef, snap=>{
    log("Firestore connected ‚úÖ");
    log("Contacts found: "+snap.size, snap.size ? "ok" : "warn");

    const list = document.getElementById("contacts");
    list.innerHTML = "";

    snap.forEach(doc=>{
      const c = doc.data();
      const div = document.createElement("div");
      div.className = "contact";
      div.innerText = `Name: ${c.name} | UserID: ${c.userId}`;
      list.appendChild(div);
    });

    if(snap.size===0){
      log("No contacts in Firestore path", "warn");
    }
  }, err=>{
    log("Firestore error: "+err.message, "err");
  });
});

// üîπ Add contact
window.addContact = async ()=>{
  const name = document.getElementById("cName").value || "UNKNOWN";
  const userId = document.getElementById("cId").value.trim();

  if(!userId){
    log("User ID is required ‚ùå","err");
    return;
  }

  await addDoc(
    collection(db,"contacts",auth.currentUser.uid,"list"),
    {
      name,
      userId,
      createdAt: Date.now()
    }
  );

  log("Contact added successfully ‚úÖ");

  document.getElementById("cName").value="";
  document.getElementById("cId").value="";
};
</script>

</body>
</html>
