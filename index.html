<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>IEM Chat – Debug Mode</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background:#0f1720;
  color:#e5e7eb;
  font-family: monospace;
  padding:20px;
}
.status {
  margin:10px 0;
  padding:10px;
  border-radius:6px;
}
.ok { background:#064e3b; }
.warn { background:#78350f; }
.err { background:#7f1d1d; }
button {
  padding:10px 15px;
  margin-top:15px;
  cursor:pointer;
}
</style>
</head>
<body>

<h2>IEM CHAT – DEBUG MODE</h2>

<div id="log"></div>

<button onclick="testRender()">TEST RENDER CONTACT</button>

<div id="contacts"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const log = (msg, cls="ok")=>{
  const d = document.createElement("div");
  d.className = "status "+cls;
  d.innerText = msg;
  document.getElementById("log").appendChild(d);
};

log("JS running ✅");

const firebaseConfig = {
  apiKey: "AIzaSyDCBD2gVIg9v-KqYaMFZeu_grgs3yKYfPs",
  authDomain: "fir-chat-f8d55.firebaseapp.com",
  projectId: "fir-chat-f8d55",
  storageBucket: "fir-chat-f8d55.appspot.com",
  messagingSenderId: "792896094694",
  appId: "1:792896094694:web:dd373e5d7d2fc9ae1d5627"
};

const app = initializeApp(firebaseConfig);
log("Firebase initialized ✅");

const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, user=>{
  if(!user){
    log("No authenticated user ❌", "err");
    return;
  }

  log("User authenticated ✅ UID: "+user.uid);

  const contactsRef = collection(db, "contacts", user.uid, "list");

  onSnapshot(contactsRef, snap=>{
    log("Firestore connected ✅", "ok");
    log("Contacts found: "+snap.size, snap.size ? "ok" : "warn");

    const cDiv = document.getElementById("contacts");
    cDiv.innerHTML = "<h3>Contacts:</h3>";

    snap.forEach(doc=>{
      const p = document.createElement("p");
      p.innerText = JSON.stringify(doc.data());
      cDiv.appendChild(p);
    });

    if(snap.size === 0){
      log("No contacts in Firestore path", "warn");
    }
  }, err=>{
    log("Firestore error: "+err.message, "err");
  });
});

window.testRender = ()=>{
  const cDiv = document.getElementById("contacts");
  const p = document.createElement("p");
  p.innerText = "TEST CONTACT RENDERED LOCALLY";
  cDiv.appendChild(p);
  log("Local render works ✅");
};
</script>

</body>
</html>
